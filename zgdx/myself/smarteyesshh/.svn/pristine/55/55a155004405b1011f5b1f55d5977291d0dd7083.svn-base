<%@ page language="java" pageEncoding="UTF-8"%>
<%@ page contentType="text/html;charset=UTF-8"%>
<%@ include file="/WEB-INF/common/taglib.jsp"%>
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>账户设置</title>
    <link rel="stylesheet" href="${js}/bootstrap/css/bootstrap.css" />
    <link rel="stylesheet" href="${css}/base.css" />
    <link rel="stylesheet" href="${css}/style.css" />
    <link rel="stylesheet" href="${css}/style2.css" />
    <link rel="stylesheet" href="${css}/style4.css" />
    <link rel="stylesheet" href="${css}/style5.css" />
    <link rel="stylesheet" href="${js}/bootstrap-datetimepicker/bootstrap-datetimepicker.css" />
    <script type="text/javascript" src="${js}/jquery-2.1.0.js" ></script>
    <script type="text/javascript" src="${js}/bootstrap/js/bootstrap.js" ></script>
    <script type="text/javascript" src="${js}/bootstrap-datetimepicker/bootstrap-datetimepicker.js" ></script>
    <script type="text/javascript" src="${js}/bootstrap-datetimepicker/bootstrap-datetimepicker.zh-CN.js" ></script>
    <script type="text/javascript" src="${js}/echarts.js" ></script>
    <script type="text/javascript" src="${js}/ZUONbpqGBsYGXNIYHicvbAbM.js" ></script>
    <script type="text/javascript" src="${js}/bmap.js" ></script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=Zl1DTZtwQh8Vfk7G8PpVExYywZAmET9p"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/library/Heatmap/2.0/src/Heatmap_min.js"></script>

    <script>
        $(function(){
            $('input.datetimepicker').datetimepicker({
                format: 'yyyy-mm-dd hh:ii',
                language:'zh-CN'
            });

        })
    </script>
    <style>
    </style>
</head>
<body>
<div class="container-fluid smartEyes-container">
    <%--<input type="hidden" value="${userType}" id="userType"/>--%>
    <jsp:include page="/WEB-INF/common/head.jsp"/>

    <%--<header class="row">--%>
        <%--<!--logo-->--%>
        <%--<div class="col-lg-2  col-md-2 col-xs-2 logo"><a><img src="${img}/1logo.png" alt=""></a></div>--%>
        <%--&lt;%&ndash;<div class="col-lg-5 col-md-5 col-xs-5">&ndash;%&gt;--%>
        <%--&lt;%&ndash;<ul class="nav nav-pills navList" id="navList">&ndash;%&gt;--%>
        <%--&lt;%&ndash;<li role="presentation" class=""><a href="${ctx}/overview?targetPhone=${targetPhone}"><i><img id="img1" src="${img}/u-03.png"></i>概览</a></li>&ndash;%&gt;--%>
        <%--&lt;%&ndash;<li role="presentation" class=""><a href="${ctx}/contact?targetPhone=${targetPhone}"><i><img id="img2" src="${img}/u-04.png"></i>联系人列表</a></li>&ndash;%&gt;--%>
        <%--&lt;%&ndash;<li role="presentation" class=""><a href="${ctx}/region?targetPhone=${targetPhone}"><i><img  id="img3" src="${img}/u-05.png"></i>区域与轨迹</a></li>&ndash;%&gt;--%>
        <%--&lt;%&ndash;<!--<li role="presentation" class=""><a href="帐号.html"><i></i>帐号</a></li>-->&ndash;%&gt;--%>
        <%--&lt;%&ndash;</ul>&ndash;%&gt;--%>
        <%--&lt;%&ndash;</div>&ndash;%&gt;--%>
        <%--<!--<div class="col-lg-4">--%>
            <%--<div class="form-group">--%>
                <%--<input type="text"class="form-control"  />--%>
            <%--</div>--%>

        <%--</div>-->--%>
        <%--<div class="col-lg-1 col-md-1 col-xs-1 fr">--%>
            <%--<a href="${ctx}/search"><img src="${img}/u03.png"></a>--%>
        <%--</div>--%>
        <%--<div class="col-lg-1 col-md-1 col-xs-1 pull-right text-right input-group fr" style="margin-top: 27px">--%>
            <%--<select class="pull-right select myselect" onchange="operateManage(this.options[this.options.selectedIndex].value)">--%>
                <%--<option value="configure" selected=''>&nbsp;配置</option>--%>
                <%--<option value="userOperateLog">&nbsp;用户操作日志</option>--%>
                <%--<option value="targetPersonManage">&nbsp;目标人员管理</option>--%>
                <%--<option value="systemRightManage">&nbsp;系统权限管理</option>--%>
            <%--</select>--%>
        <%--</div>--%>
    <%--</header>--%>
    <script>
        <%--function operateManage(value) {--%>

            <%--switch(value){--%>
                <%--case "userOperateLog":--%>
                    <%--//当天热力--%>
                    <%--window.location.href="${ctx}/system";--%>
                    <%--break;--%>
                <%--case "targetPersonManage":--%>
                    <%--window.location.href="${ctx}/system";--%>
                    <%--break;--%>
                <%--case "systemRightManage":--%>
                    <%--window.location.href="${ctx}/system";--%>
                    <%--break;--%>

            <%--}--%>

        <%--}--%>

    </script>
    <div class="sysmg-pannel">
        <ul>
            <li class="sysmg-tbum">
                <a class="sysmg-b " href="${ctx}/permission">
                    <span class="sysmg-icon sysmg-icon1 "></span>
                    <p>用户管理</p>
                </a>
                <p class="holdarea">

                </p>
            </li>

            <li>
                <a class="sysmg-b active" href="${ctx}/account">
                    <span class="sysmg-icon sysmg-icon2"></span>
                    <p>账号设置</p>
                </a>
            </li>
        </ul>
    </div>

    <div class="row searchBox">
        <div class="col-lg-12 col-md-12 col-xs-12 namelist clearfix">
        </div>

        <!--操作表单-->
        <div class="col-lg-12 col-md-12 col-xs-12 sysmg-box">
            <!--图表展示列表-->
            <div class="sysmg-rbox " >
                <div class = "sysmg-getuser" >
                    <%--<form>--%>
                    <div class="item">
                        <span class="label">用户ID : </span>
                        <span class="content"></span>
                    </div>
                    <div class="item">
                        <span class="label">姓&nbsp;&nbsp;名 :  </span>
                        <span class="content"></span>
                    </div>
                    <div class="item">
                        <span class="label">手机号 :</span>
                        <span class="content"></span>
                    </div>

                    <input type="submit" value="修改密码" class="sysmg-cgpwBtn " />
                    <%--</form>--%>
                </div>
                <div class="sysmg-cp " style="display: none">
                    <%--<form>--%>
                    <div class="item">
                        <span class="label">当前登录密码 : </span>
                        <input type="text" name="cpuser1" class="fl"/>
                        <span class="label alabel"><a href="#">忘记密码?</a></span>
                    </div>
                    <div class="item">
                        <span class="label">新的登录密码 :  </span>
                        <input type="text" name="cpuser2" class="fl"/>
                    </div>
                    <div class="item">
                        <span class="label">确认新的登录密码 :</span>
                        <input type="text" name="cpuser3" class="fl" />
                    </div>

                    <input type="submit" value="确定" class="sysmg-cfBtn" />
                </div>
                <div class="sysmg-tips" style="display: none">
                    <p>设置成功！请牢记新的登录密码。</p>
                    <a href="${ctx}/login">重新登录</a>
                </div>

            </div>

        </div>
    </div>
    <!--底部-->
    <footer style="position: fixed; bottom:0px"><p class="text-center">© 2017 SmarttEyes | 猎犬上海网安版</p></footer>
    <script>
        var ut = $("#userType").val();
        if(ut==="0"){

        }else {
            $(".sysmg-tbum").css("display","none");
        }

        $("#navList").css("display","none");

        //动态获取阴影高度
        var h= $(window).height();
        $(".sysmg-rbox").height(h-226);
        //pannel高度
        $(".sysmg-pannel").height(h-120);

        $(window).resize(function(){
            var h= $(window).height();
            $(".sysmg-rbox").height(h-226);
            $(".sysmg-pannel").height(h-120);
        });
        //设置选中
        $(".myselect").children("option").removeAttr("selected");
        $(".myselect").children("option[value='systemRightManage']").attr("selected",true);
        //change事件
        <%--function operateManage(value) {--%>

            <%--switch(value){--%>
                <%--case "configure":--%>
                <%--&lt;%&ndash;window.location.href="${ctx}/system";&ndash;%&gt;--%>
                    <%--break;--%>
                <%--case "userOperateLog":--%>
                    <%--window.location.href="${ctx}/system";--%>
                    <%--break;--%>
                <%--case "targetPersonManage":--%>
                    <%--window.location.href="${ctx}/person";--%>
                    <%--break;--%>
                <%--case "systemRightManage":--%>
                    <%--window.location.href="${ctx}/permission";--%>
                    <%--break;--%>

            <%--}--%>

        <%--}--%>
        $(function(){
            getUser();

            changePw();

            function getUser() {
                $.ajax({
                    type: "GET",
                    url: "user/getUser",
                    dataType: "json",
//                data:{"usernick":newuser[0],"username":newuser[1],"password":newuser[2]},
                    success: function (res) {

                        $(".sysmg-getuser").find("span.content").eq(0).text("" + res.id);
                        $(".sysmg-getuser").find("span.content").eq(1).text("" + res.name);
                        $(".sysmg-getuser").find("span.content").eq(2).text("" + res.phone);


                    }, error: function () {
                        console.log("添加提交错误");
                    }

                })
            }

            function changePw() {
                var newpw = [];
                $(".sysmg-cgpwBtn").click(
                    function () {
                        $(".sysmg-getuser").css("display", "none");
                        $(".sysmg-cp").css("display", "block");
                        $(".sysmg-tips").css("display", "none");
                        //点击确定按钮
                        $(".sysmg-cfBtn").unbind().click(
                            function () {
                                var newstatus = 1;
                                for (var i = 0; i < 3; i++) {
                                    var mystring = "cpuser" + (i + 1);
                                    newpw[i] = $(".sysmg-cp").find("input[name='" + mystring + "']").val();
                                    if (newpw[i] === "") {
                                        newstatus = 0;
                                        alert("密码不能为空");
                                        break;
                                    }
                                }
                                console.log(newpw);
                                if(newpw[1]!==newpw[2]){
                                    alert("确认密码与新密码不一致");
                                }

                                if (newpw[1]===newpw[2] && newstatus === 1) {

                                    $.ajax({
                                        type: "GET",
                                        url: "user/changePwd",
                                        dataType: "json",
                                        data: {"oldPwd": newpw[0], "newPwd": newpw[1]},
                                        success: function (res) {
                                            if (res.result === 1) {
                                                alert("修改密码成功");
                                            $(".sysmg-tips").css("display","block");
                                            $(".sysmg-cp").css("display","none");
                                            $(".sysmg-getuser").css("display","none");
//                                                window.location.reload();//刷新当前页面.

                                            } else {
                                                alert("不能修改密码");
                                                console.log(res);
                                            }
                                        }, error: function () {
                                            console.log("修改密码提交错误");
                                        }

                                    })
                                } else {
                                }


                            }
                        );

                    })
            }
        })

       
       










    </script>

</body>
</html>

